{% comment %}
  Recent Viewed Products Section
{% endcomment %}

<section 
  id="zs-recent-viewed-{{ section.id }}"
  class="zs-section"
  style="
    padding-top: {{ section.settings.padding_top_desktop }}px;
    padding-bottom: {{ section.settings.padding_bottom_desktop }}px;
    margin-top: {{ section.settings.margin_top_desktop }}px;
    margin-bottom: {{ section.settings.margin_bottom_desktop }}px;
    background-color: {{ section.settings.bg_color }};
    {% if section.settings.bg_image != blank %}
      background-image: url({{ section.settings.bg_image | image_url }});
      background-size: {{ section.settings.bg_size }};
      background-position: {{ section.settings.bg_position }};
    {% endif %}
  "
>

  {% if section.settings.bg_overlay != blank %}
  <div class="zs-bg-overlay"></div>
  {% endif %}

  <div class="zs-container">

    {# ---------------- HEADER ---------------- #}
    {% if section.settings.subtitle != blank 
       or section.settings.title != blank 
       or section.settings.description != blank %}
    <div class="zs-header" style="text-align: {{ section.settings.header_alignment }};">
      
      {% if section.settings.subtitle != blank %}
      <p class="zs-subtitle"
        style="
          color: {{ section.settings.subtitle_color }};
          font-size: {{ section.settings.subtitle_size_desktop }}px;
        "
      >{{ section.settings.subtitle }}</p>
      {% endif %}

      {% if section.settings.title != blank %}
      <h2 class="zs-title"
        style="
          color: {{ section.settings.title_color }};
          font-size: {{ section.settings.title_size_desktop }}px;
        "
      >{{ section.settings.title }}</h2>
      {% endif %}

      {% if section.settings.description != blank %}
      <p class="zs-description"
        style="
          color: {{ section.settings.description_color }};
          font-size: {{ section.settings.description_size_desktop }}px;
        "
      >{{ section.settings.description }}</p>
      {% endif %}

      {% if section.settings.btn_text != blank %}
      <a 
        href="{{ section.settings.btn_link }}"
        class="zs-btn"
        style="
          color: {{ section.settings.btn_text_color }};
          background: {{ section.settings.btn_bg_color }};
        "
      >
        {{ section.settings.btn_text }}
      </a>
      {% endif %}

    </div>
    {% endif %}

    {# ---------------- RECENT VIEWED GRID ---------------- #}
    <div class="zs-recent-view-wrapper">
      <div id="zs-recent-view-products-{{ section.id }}" class="zs-grid"></div>
    </div>

  </div>

</section>

<script>
document.addEventListener("DOMContentLoaded", function() {

  let handles = JSON.parse(localStorage.getItem("recent_products")) || [];

  if (handles.length === 0) {
    document.getElementById("zs-recent-view-{{ section.id }}").style.display = "none";
    return;
  }

  fetch(`/products.json?limit=250`)
    .then(res => res.json())
    .then(data => {
      const products = data.products.filter(p => handles.includes(p.handle));
      const container = document.getElementById("zs-recent-view-products-{{ section.id }}");

      products.forEach(product => {
        const img = product.images[0]?.src;

        container.innerHTML += `
          <a class="zs-product" href="/products/${product.handle}">
            <div class="zs-img-wrap">
              <img src="${img}" alt="${product.title}">
            </div>
            <h3 class="zs-prod-title">${product.title}</h3>
            <p class="zs-price">${product.variants[0].price} {{ shop.currency }}</p>
          </a>
        `;
      });
    });

});
</script>

<style>
/* CONTAINER */
#zs-recent-view-{{ section.id }} {
  position: relative;
}
.zs-bg-overlay {
  position: absolute;
  inset: 0;
  background: {{ section.settings.bg_overlay }};
  pointer-events: none;
}
.zs-container {
  width: min(1200px, 90%);
  margin: auto;
  position: relative;
  z-index: 2;
}

/* HEADER */
.zs-header { margin-bottom: 35px; }
.zs-subtitle { margin-bottom: 10px; }
.zs-title { margin: 10px 0; font-weight: 700; }
.zs-description { max-width: 700px; margin: 15px auto; line-height: 1.5; }

.zs-btn {
  display: inline-block;
  padding: 12px 28px;
  border-radius: 6px;
  text-decoration: none;
  transition: 0.3s;
}
.zs-btn:hover {
  background: {{ section.settings.btn_bg_hover }};
  color: {{ section.settings.btn_text_hover }};
}

/* GRID */
.zs-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 22px;
}

.zs-product {
  text-decoration: none;
  display: block;
}

.zs-img-wrap {
  width: 100%;
  border-radius: 8px;
  overflow: hidden;
}
.zs-img-wrap img {
  width: 100%;
  display: block;
}

.zs-prod-title {
  margin: 10px 0 4px;
  font-size: 16px;
  color: #222;
}

.zs-price {
  font-size: 15px;
  color: #333;
}

/* MOBILE RESPONSIVE */
@media (max-width: 767px) {
  #zs-recent-view-{{ section.id }} {
    padding-top: {{ section.settings.padding_top_mobile }}px !important;
    padding-bottom: {{ section.settings.padding_bottom_mobile }}px !important;
    margin-top: {{ section.settings.margin_top_mobile }}px !important;
    margin-bottom: {{ section.settings.margin_bottom_mobile }}px !important;
  }

  .zs-subtitle {
    font-size: {{ section.settings.subtitle_size_mobile }}px !important;
  }
  .zs-title {
    font-size: {{ section.settings.title_size_mobile }}px !important;
  }
  .zs-description {
    font-size: {{ section.settings.description_size_mobile }}px !important;
  }

  .zs-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
  }
}
</style>

{% schema %}
{
  "name": "ZS Recent Viewed Products",
  "settings": [
    {
      "type": "header",
      "content": "Layout Settings"
    },
    { "type": "range", "id": "padding_top_desktop", "label": "Padding Top (Desktop)", "min": 0, "max": 200, "step": 5, "default": 60 },
    { "type": "range", "id": "padding_bottom_desktop", "label": "Padding Bottom (Desktop)", "min": 0, "max": 200, "step": 5, "default": 60 },
    { "type": "range", "id": "margin_top_desktop", "label": "Margin Top (Desktop)", "min": 0, "max": 200, "step": 5, "default": 0 },
    { "type": "range", "id": "margin_bottom_desktop", "label": "Margin Bottom (Desktop)", "min": 0, "max": 200, "step": 5, "default": 0 },

    { "type": "range", "id": "padding_top_mobile", "label": "Padding Top (Mobile)", "min": 0, "max": 200, "step": 5, "default": 40 },
    { "type": "range", "id": "padding_bottom_mobile", "label": "Padding Bottom (Mobile)", "min": 0, "max": 200, "step": 5, "default": 40 },
    { "type": "range", "id": "margin_top_mobile", "label": "Margin Top (Mobile)", "min": 0, "max": 200, "step": 5, "default": 0 },
    { "type": "range", "id": "margin_bottom_mobile", "label": "Margin Bottom (Mobile)", "min": 0, "max": 200, "step": 5, "default": 0 },

    {
      "type": "header",
      "content": "Background"
    },
    { "type": "color", "id": "bg_color", "label": "Background Color", "default": "#ffffff" },
    { "type": "image_picker", "id": "bg_image", "label": "Background Image" },
    {
      "type": "select",
      "id": "bg_size",
      "label": "Background Size",
      "default": "cover",
      "options": [
        { "value": "cover", "label": "Cover" },
        { "value": "contain", "label": "Contain" },
        { "value": "auto", "label": "Auto" }
      ]
    },
    {
      "type": "select",
      "id": "bg_position",
      "label": "Background Position",
      "default": "center center",
      "options": [
        { "value": "top left", "label": "Top Left" },
        { "value": "top center", "label": "Top Center" },
        { "value": "top right", "label": "Top Right" },
        { "value": "center center", "label": "Center" },
        { "value": "bottom center", "label": "Bottom Center" }
      ]
    },
    { "type": "color", "id": "bg_overlay", "label": "Overlay Color", "default": "rgba(0,0,0,0)" },

    {
      "type": "header",
      "content": "Header Content"
    },
    { "type": "text", "id": "subtitle", "label": "Subtitle" },
    { "type": "text", "id": "title", "label": "Title" },
    { "type": "textarea", "id": "description", "label": "Description" },
    { "type": "text", "id": "btn_text", "label": "Button Text" },
    { "type": "url", "id": "btn_link", "label": "Button Link" },

    {
      "type": "header",
      "content": "Header Style"
    },
    { "type": "color", "id": "subtitle_color", "label": "Subtitle Color", "default": "#333" },
    { "type": "color", "id": "title_color", "label": "Title Color", "default": "#111" },
    { "type": "color", "id": "description_color", "label": "Description Color", "default": "#444" },

    { "type": "color", "id": "btn_text_color", "label": "Button Text Color", "default": "#ffffff" },
    { "type": "color", "id": "btn_bg_color", "label": "Button Background Color", "default": "#000000" },
    { "type": "color", "id": "btn_text_hover", "label": "Button Hover Text Color", "default": "#ffffff" },
    { "type": "color", "id": "btn_bg_hover", "label": "Button Hover Background Color", "default": "#333333" },

    {
      "type": "select",
      "id": "header_alignment",
      "label": "Header Alignment",
      "default": "center",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ]
    },

    {
      "type": "header",
      "content": "Typography Sizes"
    },
    { "type": "range", "id": "subtitle_size_desktop", "label": "Subtitle Size (Desktop)", "min": 10, "max": 60, "step": 1, "default": 16 },
    { "type": "range", "id": "title_size_desktop", "label": "Title Size (Desktop)", "min": 16, "max": 80, "step": 1, "default": 32 },
    { "type": "range", "id": "description_size_desktop", "label": "Description Size (Desktop)", "min": 12, "max": 40, "step": 1, "default": 16 },

    { "type": "range", "id": "subtitle_size_mobile", "label": "Subtitle Size (Mobile)", "min": 10, "max": 50, "step": 1, "default": 14 },
    { "type": "range", "id": "title_size_mobile", "label": "Title Size (Mobile)", "min": 16, "max": 60, "step": 1, "default": 28 },
    { "type": "range", "id": "description_size_mobile", "label": "Description Size (Mobile)", "min": 12, "max": 30, "step": 1, "default": 14 }
  ],
  "blocks": [],
  "presets": [
    { "name": "Recent Viewed Products" }
  ]
}
{% endschema %}
